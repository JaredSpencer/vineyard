<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: actions/noteForm.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: actions/noteForm.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//React requirements
import { browserHistory } from 'react-router';

//AJAX
import axios from 'axios';

/**
 * Post request to retrieve weather info from Weather underground API.
 * @function getWeather
 * @param {object} note - Note object from user input.
 * @param {boolean} noteCheck - 
 * @description Initializes a POST request to Weather API based on note's latitude and longitude.
 * @memberOf noteForm Actions
 */
export function getWeather(note, noteCheck) {
  var cb = noteCheck ? setNoteWeather : setHomePageWeather;
  return dispatch => axios.post('/api/weather/byLatLon', {
    'lat': note.lat,
    'lon': note.lon
  }, { headers: { 'Authorization': 'JWT ' + localStorage.getItem('token') }
  }).then(resp => dispatch(cb(resp)))
    .catch(err => {
      console.log(err);
    });
}

export function setHomePageWeather(value) {
  return {
    type: "UPDATE_TEMP",
    value: value.data.current_observation
  };
}

export function setCurrentlyRecording(value) {
  return {
    type: "SET_CURRENTLY_RECORDING",
    value
  };
}

export function setNoteFormItem(item, value) {
  var toReturn = { value };

  toReturn.type = "SET_NOTE_FORM_" + item.toUpperCase();

  return toReturn;
}

function setNoteWeather(value) {
  return {
    type: "UPDATE_WEATHER",
    value: {temp: value.data.current_observation.temp_f +'F, ' + value.data.current_observation.temp_c + 'C' , humidity: value.data.current_observation.relative_humidity}
  };
}

export function appendNoteFormItem(item, value) {
  var toReturn = { value };

  toReturn.type = "APPEND_NOTE_FORM_" + item.toUpperCase();

  return toReturn;
}

//add in rest of cols in schema

/**
 * Post request to retrieve weather info from Weather underground API.
 * @function postNote
 * @param {object} note - Note object from user input.
 * @param {boolean} noteCheck - If true, set's note weather, if false, sets homepage weather.
 * @description Initializes a POST request to Weather API based on note's latitude and longitude.
 */
export function postNote(note) {
  
  return dispatch => axios.post('/api/note', {
    title: note.title,
    text: note.textArea,
    date_time: note.date,
    latitude: note.lat,
    longitude: note.lon,
    image_url: note.uploadedImgUrl,
    note_author_id: note.username
  }, { headers: {'Authorization': 'JWT ' + localStorage.getItem('token') } })
  .then(() => {
    dispatch(clearNoteFields());
    browserHistory.push('/home');

    })
  .catch((err) => {
    console.log(err);
  })
}

export function clearNoteFields() {
  return {
    type: "CLEAR_NOTE_FIELDS"
  };
}


/**
 * Upload Image to Imgur
 * @function uploadImgToImgur
 * @param {string} image - Note object from user input.
 * @description Formats image string and sends post request to add image to imgur API.
 */
export function uploadImgToImgur(image) {
  if (image !== '') {
    return {
      type: "SET_UPLOADED_IMG_URL",
      payload: {
        promise: axios.post('https://api.imgur.com/3/image',
          {
            image: image.split(',')[1],
            type: 'base64'
          },
          {
            headers: {
              Authorization: 'Client-ID d945621dec69149',
              Accept: 'application/json'
            }
          }).then(resp => {
            browserHistory.push('/formValidation');
            return resp.data.data.link;
          }).catch(err => {
            console.log('this is err', err);
          })
      }
    }
  } else {
    browserHistory.push('/formValidation');
  }
}

export function setSelectedImage(value) {
  return {
    type: "SET_SELECTED_IMG",
    value
  };
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#getAnalysis">getAnalysis</a></li><li><a href="global.html#getWeather">getWeather</a></li><li><a href="global.html#parseData">parseData</a></li><li><a href="global.html#postNote">postNote</a></li><li><a href="global.html#showMap">showMap</a></li><li><a href="global.html#uploadImgToImgur">uploadImgToImgur</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Mar 09 2017 16:31:45 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
